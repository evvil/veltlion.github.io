<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 给海美迪 H7 四代刷第三方固件 · 空</title><meta name="description" content="给海美迪 H7 四代刷第三方固件 - 空"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://veltlion.github.io/atom.xml" title="空"></head><body><div class="wrap"><header><script>function cPic(){var num=Math.ceil(Math.random()*40);document.getElementById("cpic").src="/img/デフォルメティッシュちゃん ("+num+").png"}</script><!--a.logo-link(href=url_for())--><!--    img(src=url_for(theme.logo) alt="logo")--><script>var num=Math.floor(40*Math.random())+1;document.write("<a class='logo-link'><img src='/img/デフォルメティッシュちゃん ("+num+").png' id='cpic' alt='logo' onclick='cPic()'></a>");</script><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">给海美迪 H7 四代刷第三方固件</h1><div class="post-info">2017年9月26日</div><div class="post-content"><p>　　前几天给盒子清数据，连上网就被自动装了 CIBN聚精彩 、CIBN聚体育。<br>　　emmmmm…<br>　　加上之前这系统用着各种不爽，像是没有通知栏啊、太丑啊、版本太低啊、刷了 Google 服务 SPMC 就打不开了之类的，所以干脆刷成别的好了。找找发现 S912 有好多包，LibreELEC、Lakka、Android 之类的。<br>　　后来我发现这玩意还能装 Linux ，真是神奇，不过 Linux 的话还是等我这盒子退休再说吧。<br><a id="more"></a><!-- toc --></p>
<h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><p>刷什么之前都应该先做好备份，因为官方根本就没提供固件，只有卡刷包。</p>
<ol>
<li>盒子执行（需要root）<br><code>/system/xbin/busybox nc -l -p 5000 -e /system/xbin/busybox dd if=/dev/block/mmcblk0</code></li>
<li>电脑执行<br><code>nc 盒子IP 5000 | pv -i 0.5 &gt; mmcblk0</code></li>
</ol>
<p>ps. 也可以不备份 data 分区，这样文件会比较小，也会省很多时间和空间。<br><code>/system/xbin/busybox nc -l -p 5000 -e /system/xbin/busybox dd if=/dev/block/mmcblk0 bs=4096 count=658432</code><br>　　不过这样备份的话，恢复完要进 第三方rec 或用 LibreELEC 格式化下 data 分区，不然不能开机。<br>备份这段时间我们可以去下载刷机包。</p>
<h3 id="其他-Android"><a href="#其他-Android" class="headerlink" title="其他 Android"></a>其他 Android</h3><p><img src="f_Android.jpg" alt="Android"><br>　　刷机会清除全部数据，记得备份原系统和数据。<br>　　另外再备份下这两个文件，刷完再恢复。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 蓝牙遥控器键值</span><br><span class="line">/system/usr/keylayout/HIMEDIA.kl</span><br><span class="line"># 红外遥控器键值</span><br><span class="line">/system/etc/remote.conf</span><br></pre></td></tr></table></figure></p>
<ul>
<li>用 BootcardMaker 制作启动卡。然后插进盒子，执行<code>reboot update</code>，盒子会重启升级。 </li>
<li>或是用双公头 USB 线连接电脑和盒子（插靠后面的 USB 口）用 USB Burning Tool 刷写。 </li>
</ul>
<h4 id="一些固件的下载地址"><a href="#一些固件的下载地址" class="headerlink" title="一些固件的下载地址"></a>一些固件的下载地址</h4><ul>
<li><a href="http://freaktab.com/forum/tv-player-support/beelink-aa/beelink-android-tv-box/gt1/firmware-roms-tools-cg/611261" target="_blank" rel="noopener">Android 6.1</a> 自带 Samba ，启动器带通知显示。上面的截图就是这个固件。刷完要再进 recovery 刷下帖子里的 A912(AP6255) Wifi/BT Fix ，不然 WiFi 不能用。</li>
<li><a href="http://freaktab.com/forum/tv-player-support/beelink-aa/beelink-android-tv-box/gt1/firmware-roms-tools-cg/659653" target="_blank" rel="noopener">Android 7.1</a> 自带 Google 全家桶的 Android 7.1 固件。</li>
<li><del><a href="http://freaktab.com/forum/tv-player-support/beelink-aa/beelink-android-tv-box/gt1/firmware-roms-tools-cg/659783" target="_blank" rel="noopener">Android TV 7.1.2</a> 自带 Google 全家桶的 Android TV 7.1 固件。</del>最近更新后蓝牙遥控器会失效。</li>
<li><a href="http://freaktab.com/forum/tv-player-support/beelink-aa/beelink-android-tv-box/gt1/firmware-roms-tools-cg/657916" target="_blank" rel="noopener">Android TV 7.1.2</a> 只有 Play 服务、商店和 YouTube，data 分区比较大，钛备份看到有 12.3 GiB 。目前在用，不过精简的有点多，DocumentsUI 都没，可以从上面的包里面提取。</li>
<li>可以自己 Google 搜索或是去 freaktab 这类的地方找。</li>
</ul>
<h4 id="一些问题和解决办法"><a href="#一些问题和解决办法" class="headerlink" title="一些问题和解决办法"></a>一些问题和解决办法</h4><ul>
<li>蓝牙遥控器只能关机不能开机：按钮改成休眠后可休眠唤醒。不过盒子24小时挂着 BT 下动画片，用不着关机功能问题也不大。</li>
<li>红蓝按钮：修改<code>HIMEDIA.kl</code>，把红蓝键改成别的功能（<a href="https://developer.android.com/reference/android/view/KeyEvent.html" target="_blank" rel="noopener">按键参考</a>）。我这有一个<a href="HIMEDIA.kl">改好的</a>，红色是静音，蓝色是截图。</li>
<li>鼠标模式：安装 <a href="https://www.allfreeapk.com/mouse-toggle-for-android-tv,12904361/" target="_blank" rel="noopener">Mouse Toggle for Android TV</a> ，启用无障碍，按音量减再快速按音量加开启，HOME 关闭。</li>
<li>语音：换个支持 Android TV 语音的遥控器。或者在手机上装个 <a href="https://play.google.com/store/apps/details?id=com.google.android.tv.remote" target="_blank" rel="noopener">Android TV Remote Control</a> 。</li>
</ul>
<p>前几天自带的蓝牙遥控器坏掉了，我脑抽花80大洋买了个原厂白的…现在想想还不如买个飞鼠。</p>
<h3 id="LibreELEC"><a href="#LibreELEC" class="headerlink" title="LibreELEC"></a>LibreELEC</h3><p><img src="f_LibreELEC.jpg" alt="LibreELEC"><br>　　<a href="https://libreelec.tv/" target="_blank" rel="noopener">LibreELEC</a> 其实就是个 kodi ，扩展比 kodi 多点。跟 Android 版的 kodi 比起来就是多了些程序，放 H265 不会花屏了。也能装 entware 之类的。<br>　　<a href="http://www.lakka.tv/get/linux/s912/" target="_blank" rel="noopener">Lakka</a> 也已经支持 S912 了，安装和 LibreELEC 差不多。<br>　　它们都可以装到 SD 卡里面，官方的<a href="https://forum.libreelec.tv/thread/5556" target="_blank" rel="noopener">安装说明</a>写的很详细，照着做就好了。<br>　　另外这两个蓝牙遥控器也是只能关机不能开机，按钮改成休眠后可休眠唤醒。</p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p><img src="f_Armbian.png" alt="Armbian"><br>　　装 Linux 的话可以直接用别人做好的镜像做启动卡，有 Debian、ArchLinux、openSUSE 和 AltLinux 的，可以去<a href="http://freaktab.com/forum/tv-player-support/amlogic-based-tv-players/606133" target="_blank" rel="noopener">这个帖子</a>下载。<br>　　<strong>我试了几个镜像 HDMI 都没有声音，据制作者说 4.14 内核的有声音，不过我用那个盒子开机没有信号。</strong></p>
<ol>
<li>用 dd 或是 Win32DiskImage 之类的软件把镜像写到SD卡或U盘。</li>
<li>修改文件。<br>a. 打开SD卡的第一分区，看看里面有没有<code>aml_autoscript</code>文件，没有就把<code>s905_autoscript</code>改名<code>aml_autoscript</code>。<br>b. 把 dtbs 里面的<code>gxm_q201_2g.dtb</code>改名<code>dtb.img</code>复制到上级目录。<br>c. 按需修改<code>hdmi.sh</code>和<code>armbian_first_run.txt</code>。</li>
<li>把卡插进盒子，执行<code>reboot update</code>。Armbian 的<code>root</code>密码是<code>1234</code>，其他的那个帖子里面有说。</li>
<li><p>加载无线网卡驱动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">modprobe dhd</span><br><span class="line"><span class="built_in">echo</span> dhd &gt;&gt; /etc/modules</span><br><span class="line"><span class="comment"># 下面的可能不需要</span></span><br><span class="line"><span class="comment"># modprobe cfg80211</span></span><br><span class="line"><span class="comment"># echo cfg80211 &gt;&gt; /etc/modules</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm /etc/resolv.conf</span><br><span class="line"><span class="built_in">echo</span> nameserver 192.168.1.1 &gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="刷回官方（恢复备份）"><a href="#刷回官方（恢复备份）" class="headerlink" title="刷回官方（恢复备份）"></a>刷回官方（恢复备份）</h3><ol>
<li>盒子执行<br><code>/system/xbin/busybox nc -l -p 5000 -e /system/xbin/busybox dd of=/dev/block/mmcblk0</code></li>
<li>电脑执行<br><code>dd if=mmcblk0 | nc 盒子IP 5000</code></li>
</ol>
<p>恢复的时候好多坑，在这里说一下。<br>如果恢复完不能开机，拔出 SD 卡和 U 盘，按住 reset 再插电源进 recovery ，官方的 rec 会自动清数据然后重启。<br>还是不行的话，用第三方 rec 或 LibreELEC 格式化下 data 分区。<br>还有一点要注意就是用 LibreELEC 或 Linux 格式化分区的时候要指定分区名。像是这样：<code>mkfs.ext4 -L data /dev/data</code></p>
<h3 id="官方固件一些问题的解决方法"><a href="#官方固件一些问题的解决方法" class="headerlink" title="官方固件一些问题的解决方法"></a>官方固件一些问题的解决方法</h3><ul>
<li>没有通知栏：装 Snowball Smart Notifications 显示通知。</li>
<li>刷了 Goolge 服务包后 SPMC 打不开：不用 Google 服务或是换用 FTMC 。因为刷非海美迪官方提供的 Google 服务包会过不了 Play 商店的验证，好多软件不能安装和更新。</li>
<li>没有最近任务界面：插个飞鼠或者键盘 Alt + Tab 。</li>
<li>官方固件偷偷给用户推送软件：<ul>
<li>后台偷偷安装软件的是系统自带的启动器，可以换用第三方启动器然后直接删掉或禁用自带的启动器（其实好多自带软件都可以删）。</li>
<li>后来通过抓包找到推送列表地址，也可以在 hosts 里面加上一句<code>127.0.0.1 apkhome.hinavi.cp81.ott.cibntv.net</code>屏蔽。</li>
<li>屏蔽推送和广告的 <a href="hosts">hosts</a> 。</li>
</ul>
</li>
</ul>
<p><img src="f_抓包.png" alt="抓包"><br>还有一些<a href="https://yadi.sk/d/lyF8wTHV3Xzwnm" target="_blank" rel="noopener">有的没的</a>。</p>
</div></article></div></main><footer><div class="paginator"><a href="/真好看啊/" class="prev">上一篇</a><a href="/change-uefi-boot-logo/" class="next">下一篇</a></div><script src="https://cdnjs.cat.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/Valine.min.js"></script><div id="comment"></div><script>new Valine({
    av: AV, 
    el: '#comment',
    notify:false, 
    verify:false, 
    appId: '4PRFCeNilpABAutJlqdmectP-gzGzoHsz',
    appKey: 'X2snnlim2EiRUn2OcbXkPreB',
    placeholder: ' ',
    path:window.location.pathname, 
    avatar:'retro' 
});

</script><div class="copyright"><p>© 2014 - 2018 <a href="https://veltlion.github.io">空</a></p></div></footer></div><!-- script(async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous")--><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-106826273-1",'auto');ga('send','pageview');</script></body></html>