<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 编译 Aria2 笔记 · 空</title><meta name="description" content="编译 Aria2 笔记 - 空"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://veltlion.github.io/atom.xml" title="空"></head><body><div class="wrap"><header><script>function cPic(){var num=Math.ceil(Math.random()*40);document.getElementById("cpic").src="/img/デフォルメティッシュちゃん ("+num+").png"}</script><!--a.logo-link(href=url_for())--><!--    img(src=url_for(theme.logo) alt="logo")--><script>var num=Math.floor(40*Math.random())+1;document.write("<a class='logo-link'><img src='/img/デフォルメティッシュちゃん ("+num+").png' id='cpic' alt='logo' onclick='cPic()'></a>");</script><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">编译 Aria2 笔记</h1><div class="post-info">2017年12月7日</div><div class="post-content"><p>　　从官网下的 Aria2 放机顶盒里一直打不开，提示 <code>aria2c: not executable: 32-bit ELF file</code> ，再加上官方的 Aria2 有连接数限制。所以就想自己编译个试试。<br>　　机顶盒是 S912 的，Win10 的 WSL 挺方便的，直接装 <code>aarch64-linux-gnu</code> 编译器静态编译。<br><a id="more"></a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gcc-aarch64-linux-gnu g++-aarch64-linux-gnu pkg-config-aarch64-linux-gnu</span><br><span class="line"><span class="comment"># 因为脚本写有些东西要放在编译器目录里，所以再 </span></span><br><span class="line">sudo chown <span class="variable">$UID</span> -R /usr/aarch64-linux-gnu</span><br></pre></td></tr></table></figure></p>
<p>有人写了静态交叉编译<a href="https://github.com/q3aql/aria2-static-builds" target="_blank" rel="noopener">脚本</a>，改改就能用了。</p>
<p>修改的部分<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注释掉 TOOL_BIN_DIR 和 PATH</span></span><br><span class="line">ARCH=<span class="string">"aarch64"</span></span><br><span class="line">HOST=<span class="string">"aarch64-linux-gnu"</span></span><br><span class="line">PREFIX=<span class="string">"/opt/aria2-arm/build_libs"</span></span><br><span class="line">LOCAL_DIR=<span class="string">"/opt/aria2-arm/build_libs"</span></span><br><span class="line"><span class="comment"># march 可以在盒子里用 `gcc -c -Q -march=native --help=target | grep march` 获取。</span></span><br><span class="line">CFLAGS=<span class="string">"-march=armv8-a+crypto+crc -mtune=cortex-a53"</span></span><br><span class="line">DEST=<span class="string">"/usr/aarch64-linux-gnu"</span></span><br></pre></td></tr></table></figure></p>
<p><code>aria2-arm-rbpi-gnu-linux-cross-config</code>里面加上去除 Aria2 最大连接数限制的补丁。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://aur.archlinux.org/cgit/aur.git/plain/aria2-fast.patch?h=aria2-fast</span><br><span class="line">patch -Np1 &lt; aria2-fast.patch</span><br></pre></td></tr></table></figure></p>
<p>执行完脚本再 make、strip 就完了。<br>不过编译完之后放机顶盒里面还是打不开，又换别的编译器编译了几次，还是不行，这就很神奇。<br>到最后本萌妹惊讶的发现，盒子上面的 aria2c 和本地的大小不一样……<br>最后检查了 FileZilla 设置才发现传输类型是自动选择，改成二进制再传一遍，<br>就可以跑了……<br>就可以跑了……<br>就可以跑了……<br>当时我就这个表情。<img src="/img/34.png" alt="这个表情"><br>我浪费了这么多时间就是因为这个！？</p>
</div></article></div></main><footer><div class="paginator"><a href="/蛋炒饭/" class="prev">上一篇</a><a href="/真好看啊/" class="next">下一篇</a></div><script src="https://cdnjs.cat.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/Valine.min.js"></script><div id="comment"></div><script>new Valine({
    av: AV, 
    el: '#comment',
    notify:false, 
    verify:false, 
    appId: '4PRFCeNilpABAutJlqdmectP-gzGzoHsz',
    appKey: 'X2snnlim2EiRUn2OcbXkPreB',
    placeholder: ' ',
    path:window.location.pathname, 
    avatar:'retro' 
});

</script><div class="copyright"><p>© 2014 - 2018 <a href="https://veltlion.github.io">空</a></p></div></footer></div><!-- script(async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous")--><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-106826273-1",'auto');ga('send','pageview');</script></body></html>