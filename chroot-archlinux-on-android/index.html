<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 在 Android 手机上 chroot ArchLinux · 空</title><meta name="description" content="在 Android 手机上 chroot ArchLinux - 空"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://veltlion.github.io/atom.xml" title="空"></head><body><div class="wrap"><header><script>function cPic(){var num=Math.ceil(Math.random()*40);document.getElementById("cpic").src="/img/デフォルメティッシュちゃん ("+num+").png"}</script><!--a.logo-link(href=url_for())--><!--    img(src=url_for(theme.logo) alt="logo")--><script>var num=Math.floor(40*Math.random())+1;document.write("<a class='logo-link'><img src='/img/デフォルメティッシュちゃん ("+num+").png' id='cpic' alt='logo' onclick='cPic()'></a>");</script><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">在 Android 手机上 chroot ArchLinux</h1><div class="post-info">2015年4月13日</div><div class="post-content"><p>因为没有电脑，免费的 VPS 连接太慢操作不方便，就想搞个 Linux 在手机上面。<br><a id="more"></a><!-- toc --></p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>先下载 arm 版：<code>https://archlinuxarm.org/about/downloads</code><br>然后手机里面还要有 <code>busybox</code></p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="创建文件夹并解压"><a href="#创建文件夹并解压" class="headerlink" title="创建文件夹并解压"></a>创建文件夹并解压</h3><p>因为 sdcard 没有办法更改权限所以放到 /data 里面。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line">mkdir /data/arch</span><br><span class="line">tar xvf ArchLinuxARM-armv7-latest.tar.gz -C  /data/arch/</span><br></pre></td></tr></table></figure></p>
<h3 id="chroot-进去"><a href="#chroot-进去" class="headerlink" title="chroot 进去"></a>chroot 进去</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> LD_PRELOAD TMPDIR</span><br><span class="line">busybox mount --rbind /dev /data/arch/dev</span><br><span class="line">busybox mount --rbind /proc /data/arch/proc</span><br><span class="line">busybox mount --rbind /sys /data/arch/sys</span><br><span class="line">busybox mount -t tmpfs tmpfs /data/arch/tmp</span><br><span class="line">chroot /data/arch /bin/bash</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果手机里面配置了c4droid的gcc环境变量的的话也要先unset，不然make会一直提示segmentation fault（这个可把我坑惨了）。</p>
</blockquote>
<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><h3 id="配置-DNS"><a href="#配置-DNS" class="headerlink" title="配置 DNS"></a>配置 DNS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm /etc/resolv.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"nameserver 223.5.5.5"</span> &gt; /etc/resolv.conf</span><br><span class="line">chmod 644 /etc/resolv.conf</span><br></pre></td></tr></table></figure>
<h3 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h3><p><code>echo &#39;Server = http://mirrors.ustc.edu.cn/archlinuxarm/$arch/$repo&#39; &gt; /etc/pacman.d/mirrorlist</code></p>
<h3 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> miuna &gt; /etc/hostname</span><br><span class="line">hostname miuna</span><br></pre></td></tr></table></figure>
<h3 id="source-profile"><a href="#source-profile" class="headerlink" title="source profile"></a>source profile</h3><p><code>source /etc/profile</code></p>
<h3 id="更新系统"><a href="#更新系统" class="headerlink" title="更新系统"></a>更新系统</h3><p><code>pacman -Syu base-devel</code></p>
<h3 id="添加普通用户"><a href="#添加普通用户" class="headerlink" title="添加普通用户"></a>添加普通用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userdel alarm <span class="comment">#删除自带的</span></span><br><span class="line">useradd -m -g users -G wheel -s /bin/bash riko</span><br><span class="line">passwd riko</span><br></pre></td></tr></table></figure>
<h3 id="修改-sudoers-文件"><a href="#修改-sudoers-文件" class="headerlink" title="修改 sudoers 文件"></a>修改 sudoers 文件</h3><p><code>nano -w /etc/sudoers</code><br>添加<br><code>riko ALL=(ALL) ALL</code></p>
<h2 id="安装-yaourt"><a href="#安装-yaourt" class="headerlink" title="安装 yaourt"></a>安装 yaourt</h2><h3 id="package-query"><a href="#package-query" class="headerlink" title="package-query"></a>package-query</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://aur.archlinux.org/package-query.git</span><br><span class="line"><span class="built_in">cd</span> package-query</span><br><span class="line">makepkg -si</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<h3 id="yaourt"><a href="#yaourt" class="headerlink" title="yaourt"></a>yaourt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://aur.archlinux.org/yaourt.git</span><br><span class="line"><span class="built_in">cd</span> yaourt</span><br><span class="line">makepkg -si</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>如果这段 fakeroot 出错了，有可能是手机内核的问题。比如我的辣鸡一加3T就不行，可以刷第三方内核试试。</p>
<h2 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h2><h3 id="data-分区权限"><a href="#data-分区权限" class="headerlink" title="data 分区权限"></a>data 分区权限</h3><p>如果 sudo 提示 <code>sudo: effective uid is not 0, is /sbin/sudo on a file system with the &#39;nosuid&#39; option set or an NFS file system without root privileges?</code>的话可以重挂载/data。<br>先退出chroot，然后执行<code>mount -o,remount,suid /data</code></p>
<h3 id="dev-fd-62-No-such-file-or-directory"><a href="#dev-fd-62-No-such-file-or-directory" class="headerlink" title="/dev/fd/62: No such file or directory"></a>/dev/fd/62: No such file or directory</h3><p>chroot下执行 <code>ln -s /proc/self/fd /dev/fd</code></p>
<h3 id="网络权限"><a href="#网络权限" class="headerlink" title="网络权限"></a>网络权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g 3001 net_bt_admin</span><br><span class="line">groupadd -g 3002 net_bt</span><br><span class="line">groupadd -g 3003 inet</span><br><span class="line">groupadd -g 3004 net_raw</span><br><span class="line">usermod -a -G net_bt_admin,net_bt,inet,net_raw root</span><br><span class="line">usermod -a -G net_bt_admin,net_bt,inet,net_raw riko</span><br><span class="line">newgrp inet</span><br></pre></td></tr></table></figure>
<h3 id="内置储存权限"><a href="#内置储存权限" class="headerlink" title="内置储存权限"></a>内置储存权限</h3><p>如果把内置储存挂到这里并且用普通用户的话需要配置下。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g 1015 sdcard_rw</span><br><span class="line">groupadd -g 1023 media_rw</span><br><span class="line">groupadd -g 1028 sdcard_r</span><br><span class="line">usermod -a -G sdcard_rw,media_rw,sdcard_r riko</span><br></pre></td></tr></table></figure></p>
<p>剩下还有一大堆权限，什么录音的啊，相机的啊，GPS…一大堆。不过好像都用不到。</p>
<h2 id="完"><a href="#完" class="headerlink" title="完"></a>完</h2><p>如果手机重启后想再次进入只需要重新执行下面的命令就好啦。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">busybox mount -o,remount,suid /data</span><br><span class="line">busybox mount --rbind /dev /data/arch/dev</span><br><span class="line">busybox mount --rbind /proc /data/arch/proc</span><br><span class="line">busybox mount --rbind /sys /data/arch/sys</span><br><span class="line">busybox mount -t tmpfs tmpfs /data/arch/tmp</span><br><span class="line"><span class="built_in">unset</span> LD_PRELOAD TMPDIR</span><br><span class="line">chroot /data/arch /bin/bash</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/%E6%A2%93%281%29.gif" alt="梓(1).gif"></p>
</div></article></div></main><footer><div class="paginator"><a href="/博客从手机挪到VPS啦/" class="prev">上一篇</a><a href="/sora…/" class="next">下一篇</a></div><script src="https://cdnjs.cat.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/Valine.min.js"></script><div id="comment"></div><script>new Valine({
    av: AV, 
    el: '#comment',
    notify:false, 
    verify:false, 
    appId: '4PRFCeNilpABAutJlqdmectP-gzGzoHsz',
    appKey: 'X2snnlim2EiRUn2OcbXkPreB',
    placeholder: ' ',
    path:window.location.pathname, 
    avatar:'retro' 
});

</script><div class="copyright"><p>© 2014 - 2018 <a href="https://veltlion.github.io">空</a></p></div></footer></div><!-- script(async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous")--><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-106826273-1",'auto');ga('send','pageview');</script></body></html>